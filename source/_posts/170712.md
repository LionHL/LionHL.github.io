---
title: DOM元素捕获和冒泡都绑定了，触发几次？执行顺序如何？
date: 2017-07-12 11:28:27
tags: [笔记,javascript,DOM2事件]
---
最近看见一个题目，一个元素如果捕获和冒泡都绑定了，事件会触发几次，执行顺序如何？   
没有想到答案，感觉知识匮乏，技术太差怎么办呢？直接弄个demo看下，做个笔记记录下，免得下次又忘了。   
<!--more-->
```
<div id="one">
  <div id="two">
    <div id="three">
      <div id="four"></div>
    </div>
  </div>
</div>

<script>
  var one = document.getElementById('one');
  var two = document.getElementById('two');
  var three = document.getElementById('three');
  var four = document.getElementById('four');

  one.addEventListener('click', function () {
    console.log('one');
  }, false);
  two.addEventListener('click', function () {
    console.log('two');
  }, false);
  three.addEventListener('click', function () {
    console.log('three');
  }, false);
  four.addEventListener('click', function () {
    console.log('four');
  }, false);
</script>
```
上面代码将四个嵌套的div都绑定了冒泡，执行触发顺序为：   
当点击one时，输出：one   
当点击two时，输出：two one    
当点击three时，输出：three two one    
当点击four时，输出：four three two one   

修改下代码，将上面`addEventListener`第三个参数改为`true`，则为捕获事件，执行顺序如下：   
当点击one时，输出：one   
当点击two时，输出：one two 
当点击three时，输出：one two three    
当点击four时，输出：one two three four   

我们再来修改一下js代码，将第二个div改为捕获事件，其他不变：

```
  one.addEventListener('click', function () {
    console.log('one');
  }, false);
  two.addEventListener('click', function () {
    console.log('two-capture');
  }, true);
  three.addEventListener('click', function () {
    console.log('three');
  }, false);
  four.addEventListener('click', function () {
    console.log('four');
  }, false);
```
假设目标元素为four，执行代码，输出的是 two-capture four three one。  
one为根元素祖先，浏览器会从one -> two -> three -> four依次查找，直到找到目标元素four，接着开始向上冒泡 four -> three -> two -> one   
one为冒泡事件，忽略，   
two为捕获事件，输出two-capture,   
three为冒泡事件，忽略，
four为目标元素，输出four，然后执行冒泡，   
three为冒泡事件，输出three，   
two为捕获事件，忽略，   
one为冒泡事件，输出one   


现在测试一下某一元素同时绑定捕获和冒泡的请款，修改代码：

```
  one.addEventListener('click', function () {
    console.log('one-bubble');
  }, false);
  one.addEventListener('click', function () {
    console.log('one-capture');
  }, true);
  two.addEventListener('click', function () {
    console.log('two');
  }, false);
  three.addEventListener('click', function () {
    console.log('three');
  }, false);
  four.addEventListener('click', function () {
    console.log('four');
  }, false);
```
当目标元素为four时，触发事件，输出代码为：one-capture four three two one-bubble   
当目标元素为one时，触发事件，输出代码为：one-bubble one-capture，这时发现他并没有先执行one的捕获事件，而是先执行了冒泡事件，这是因为one声明冒泡在声明捕获的前面

#### 总结：   
* 事件绑定了几次就出发几次   
* 如果目标元素同时绑定捕获和冒泡，按照声明顺序执行   
* 其他情况严格按照DOM2标准执行，先捕获后冒泡
